name: gd-godot-engine-snapcraft
license: MIT
summary: Godot Engine
description: |
  Godot Engine
base: core22
grade: stable
confinement: strict

adopt-info: gd-godot-engine-snapcraft

architectures:
  - build-on: amd64
    build-for: amd64

apps:
  gd-godot-engine-snapcraft:
    extensions: [gnome]
    command: godot-engine/godot-engine
    plugs:
      - desktop
      - desktop-legacy
      - wayland
      - x11
      - unity7
      - home
      - opengl
      - browser-support
      - network
      - gsettings
      - pulseaudio
      - audio-playback
      - joystick
      - removable-media

parts:
  gd-godot-engine-snapcraft:
    plugin: nil
    source: https://github.com/godotengine/godot.git
    source-type: git
    override-pull: |
      craftctl default
      git checkout "$(git describe --tags `git rev-list --tags --max-count=1`)" -b latest
      craftctl set version="$(git describe --tags `git rev-list --tags --max-count=1`)"
    override-build: |
      # Python
      python3 -c "import sys; print(sys.version)"
      pip3 install scons
      
      # Version
      python3 --version
      pip3 --version
      scons --version
      
      # Scons
      scons -j$(nproc) platform=linuxbsd
      
      cd bin
      mv godot.x11.tools.64 godot-engine
      mkdir $CRAFT_PART_INSTALL/godot-engine
      mv godot-engine $CRAFT_PART_INSTALL/godot-engine
    build-packages:
      - git
      - sed
      - build-essential
      - pkg-config
      - libx11-dev
      - libxcursor-dev
      - libxinerama-dev
      - libgl1-mesa-dev
      - libglu-dev
      - libasound2-dev
      - libpulse-dev
      - libdbus-1-dev
      - libudev-dev
      - libxi-dev
      - libxrandr-dev
      - yasm
      - xvfb
      - wget
      - unzip
      - python3
      - python3-pip
      - scons
    stage-packages
      - libpulse0
      - libglu1-mesa
      - libgl1
